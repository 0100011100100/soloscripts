<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Dashboard</title>

    <!-- Firebase Configuration -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAe0hXfAJ0ijKNiGgAVfv4zG1ngADF2E4c",
            authDomain: "chatapp-90c78.firebaseapp.com",
            projectId: "chatapp-90c78",
            storageBucket: "chatapp-90c78.appspot.com",
            messagingSenderId: "195015101932",
            appId: "1:195015101932:web:f352296f341c58458a84c9",
            databaseURL: "https://chatapp-90c78-default-rtdb.firebaseio.com"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const userDatabase = {}; // This object will hold user data, including their points

        function sendMessage(username, messageText, profilePicUrl, isBot = false) {
            db.ref('messages').push().set({
                username: username,
                message: messageText,
                profilePic: profilePicUrl,
                timestamp: new Date().toISOString(),
                isBot: isBot
            });
        }

        function listenForMessages() {
            db.ref('messages').on('child_added', (snapshot) => {
                const messageData = snapshot.val();
                addMessageToChat(messageData);
                if (!messageData.isBot) {
                    updateUserPoints(messageData.username);
                }
            });
        }

        function updateUserPoints(username) {
            if (!userDatabase[username]) {
                userDatabase[username] = { points: 0 };
            }
            userDatabase[username].points += 10; // Award 10 points for each message
        }

        function addMessageToChat(messageData) {
            const messageContainer = document.createElement('div');
            messageContainer.classList.add('embed-message');

            const embedTitle = document.createElement('div');
            embedTitle.classList.add('embed-title');
            embedTitle.textContent = `${messageData.username} ${messageData.isBot ? '(Bot)' : ''}`;

            const embedDescription = document.createElement('div');
            embedDescription.classList.add('embed-description');
            embedDescription.textContent = messageData.message;

            messageContainer.appendChild(embedTitle);
            messageContainer.appendChild(embedDescription);
            document.getElementById('messages-container').appendChild(messageContainer);
        }

        function getRandomGoofyResponse() {
            const responses = [
                "Did someone mention bananas?",
                "I just saw a flying toaster!",
                "Why did the chicken cross the road? To get to the other side!",
                "I dreamt of spaghetti last night!",
                "Do you think cats know they are cute?",
                "What if clouds are just fluffy thoughts?",
                "I'm just a bot, but I'm loving this chat!",
                "Have you ever tried to catch a rainbow?",
                "Itâ€™s all about the jellybeans, right?",
                "Just keep swimming, just keep swimming!"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function getRandomFact() {
            const facts = [
                "Honey never spoils.",
                "A group of flamingos is called a 'flamboyance'.",
                "Bananas are berries but strawberries aren't.",
                "Wombat poop is cube-shaped.",
                "Octopuses have three hearts."
            ];
            return facts[Math.floor(Math.random() * facts.length)];
        }

        function sendRandomBotMessage() {
            const messageOptions = [
                getRandomGoofyResponse,
                getRandomFact,
                () => "How's everyone doing today?",
                () => "I'm here if you need me!",
            ];

            const randomMessageFunction = messageOptions[Math.floor(Math.random() * messageOptions.length)];
            sendMessage("RandomBot", randomMessageFunction(), 'default-bot-pic.png', true);
        }

        window.onload = function() {
            const username = localStorage.getItem('username') || 'Guest';
            const profilePictureUrl = localStorage.getItem('profilePic') || 'default-profile-pic.png';
            document.getElementById('username-display').textContent = username;
            document.getElementById('profile-pic').src = profilePictureUrl;
            listenForMessages();

            document.getElementById('chat-input').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    const messageText = event.target.value;
                    if (messageText) {
                        sendMessage(username, messageText, profilePictureUrl);
                        event.target.value = ''; // Clear the input
                    }
                }
            });

            // Randomly send messages from the bot at intervals
            setInterval(sendRandomBotMessage, 10000); // Every 10 seconds
        };
    </script>

    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #36393f;
            color: #dcddde;
            font-family: "Helvetica", Arial, sans-serif;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #2f3136;
            padding: 10px 20px;
            box-shadow: 0px 4px 2px -2px rgba(0,0,0,0.5);
        }

        .profile {
            display: flex;
            align-items: center;
        }

        .profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            border: 3px solid #7289da;
        }

        .embed-message {
            margin: 10px 0;
            padding: 10px;
            background-color: #2f3136;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }

        .embed-title {
            font-size: 14px;
            color: #ffffff;
            font-weight: bold;
        }

        .embed-description {
            font-size: 12px;
            color: #dcddde;
        }

        .bot-badge {
            color: #3ba55c;
            font-weight: bold;
        }

        .chat-box {
            padding: 20px;
        }

        .chat-box input {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: none;
            font-size: 14px;
            background-color: #40444b;
            color: #dcddde;
        }
    </style>
</head>
<body>

<div class="header">
    <div class="profile">
        <img id="profile-pic" src="default-profile-pic.png" alt="Profile Picture">
        <div class="username" id="username-display"></div>
    </div>
</div>

<div class="chat-box">
    <input type="text" id="chat-input" placeholder="Type your message here...">
    <div class="messages" id="messages-container"></div>
</div>

</body>
</html>
